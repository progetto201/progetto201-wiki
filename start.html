---
permalink: /start.html
layout: detailpage
containsCode: "true"
containsImage: "true"
containsCopylinks: "true"
description: "Guida iniziale progetto201"
---

<!-- CONTAINER CON IL RESTO DELLA PAGINA -->
<div class="container grow">
    <h3>Come iniziare</h3> 
        <p>
            Anche se questo e' il successore del progetto 100+100 potrebbe essere utile leggere la sua documentazione per capire
            il funzionamento alla base del progetto201. (a destra e' presente l'indice dei contenuti)
            <a class="btn orange lighten-2" href="https://github.com/mario33881/progetto_100/wiki">Wiki del progetto 100+100</a>
        </p>

        <!-- INDICE DEI CONTENUTI -->
        <h5>Indice dei contenuti:</h5>
        <br>
        
        {% include html/parsedtoc.html %}
        
        <br><hr><br>

        <ol class="collection">
            <!-- SEZIONE: RASPBIAN -->
            <li class="collection-item">
                <h4 id="raspbian">
                    Raspbian
                </h4>
                <p>Installare Raspbian/Raspberry Pi OS su Raspberry Pi (la centralina), configurarlo e aggiornarlo</p>
                <ul class="collection">
                    <li class="collection-item">
                        <p>
                            Ci sono due metodi per caricare il sistema operativo sulla scheda SD:
                        </p>
                        <blockquote>
                            Entrambe i metodi cancellano tutto il contenuto della periferica per installarci il sistema operativo,
                            essere sicuri di selezionare la scheda SD corretta e di non avere file importarti sopra.
                        </blockquote>

                        <p>Primo metodo: Scaricare dal sito ufficiale l'immagine del sistema operativo (<a href="https://www.raspberrypi.org/downloads/raspberry-pi-os/">Link</a>)</p> 

                        <div class="center-align container">
                            <img class="materialboxed mx-auto resp-img" src="/assets/img/raspbian/downloadpage.png" alt="Pagina download Raspbian">
                        </div>
                        <blockquote>
                            <p>
                                Se si desidera utilizzare un monitor collegato a Raspberry Pi per visualizzare l'interfaccia: installare "Raspberry Pi OS (32-bit) with desktop and recommended software"
                                che include il desktop e altri software utili (ad esempio il browser chromium).
                            </p>
                            <p>
                                Se si desidera affidare la responsabilita' di visualizzare l'interfaccia ad un altro dispositivo e utilizzare Raspberry Pi come puro server 
                                (e installarci sopra solamente il software necessario) si consiglia
                                di installare "Raspberry Pi OS (32-bit) Lite"
                            </p>
                        </blockquote>

                        <p>
                            e utilizzare un software per eseguire il flash sulla scheda SD (tipo etcher, <a href="https://www.balena.io/etcher/">link</a> )
                        </p>
                        <blockquote>
                            Consiglio di scompattare il file zip e di eseguire il flash direttamente con l'immagine al suo interno poiche' diverse volte 
                            che ho provato a flashare il file zip il flash falliva o il sistema operativo non si avviava...
                        </blockquote>
                        <div class="center-align container">
                            <img class="materialboxed mx-auto resp-img" src="/assets/img/raspbian/etcher.png" alt="Raspberry Pi Imager">
                        </div>
                        <p>
                            Premere su "Select Image" e selezionare il file immagine del sistema operativo, cliccare su "Select target" e selezionare la scheda SD di destinazione e infine premere "Flash!"
                            per iniziare il processo.
                        </p>

                        <p>
                            Secondo metodo: utilizzare Raspberry Pi Imager, il software consigliato dalla Raspberry Pi foundation ( <a href="https://www.raspberrypi.org/downloads/">Link</a>).
                            Con questo metodo non occorre neppure scaricare l'immagine, ci pensa il software.
                        </p>
                        <div class="center-align container">
                            <img class="materialboxed mx-auto resp-img" src="/assets/img/raspbian/rpiimager.png" alt="Raspberry Pi Imager">
                        </div>
                        <p>
                            Premere su "CHOOSE OS" per scegliere il sistema operativo da installare.
                            Selezionare "Raspberry Pi OS (Other)", perche' la prima opzione include il desktop ma senza software aggiuntivo,
                            e scegliere "Raspberry Pi OS (lite)" per installare il sistema operativo senza interfaccia (server puro)
                            oppure "Raspberry Pi OS (full)" per installare il sistema operativo con interfaccia e software aggiuntivo (Raspberry Pi visualizzera' l'interfaccia grafica su un monitor via HDMI).
                        </p>
                        <p>
                            Premere su "CHOOSE SD CARD" per scegliere la scheda SD su cui installare il sistema operativo e premere "WRITE" per iniziare il processo di flash. 
                        </p>
                    </li>
                    <li class="collection-item">
                        Se si e' scelto di installare il sistema operativo senza GUI consiglio di lavorare su Raspberry da "remoto" utilizzando SSH in modo da poter copiare e incollare i comandi da questa pagina.
                        Per abilitarlo subito al primo avvio creare un file chiamato "ssh" (senza estensione, anche vuoto) e inserirlo nella root della scheda SD.
                        A questo punto utilizzare un client SSH tipo putty (<a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">link</a>) per connettersi a Raspberry Pi via SSH.
                        <blockquote>
                            <p>
                                Occorre conoscere l'indirizzo IP del raspberry e la password.
                            </p> 
                            
                            <p>
                                Su terminale digitare il seguente comando per visualizzare l'IP delle interfacce:
                            </p>
                            <blockquote>
                                Consiglio di utilizzare fin da subito il cavo Ethernet e non il Wi-Fi poiche' nel momento in cui si creera' la rete Wi-Fi con Hostapd l'interfaccia wireless
                                sara' occupata e non sara' possibile installare altri software, cercare online soluzioni di problemi, ...
                                Se si utilizza il cavo occorre guardare l'indirizzo IP della interfaccia "eth0", altrimenti guardare l'interfaccia "wlan0". 
                            </blockquote>

                            <pre class="language-bash">
                                <code class="language-bash">
                                    {% capture code %}
                                    # se non dovesse funzionare provare "ip a"
                                    ifconfig
                                    {% endcapture %}
                                    {% include html/code.html html=code %}
                                </code>
                            </pre>

                            <p>
                                La password di default e' "raspberry".
                            </p>
                            
                        </blockquote>
                    </li>
                    <li class="collection-item">
                        Se si e' scelto di installare il sistema operativo con la GUI seguire la wizard per la configurazione iniziale che fara' configurare Wi-Fi, password di root, layout della tastiera, ...
                        e infine far aggiornare il software e far riavviare il raspberry.
                        <blockquote>
                            Consiglio di utilizzare fin da subito il cavo Ethernet e non il Wi-Fi poiche' nel momento in cui si creera' la rete Wi-Fi con Hostapd l'interfaccia wireless
                            sara' occupata e non sara' possibile installare altri software, cercare online soluzioni di problemi, ... 
                        </blockquote>
                    </li>
                </ul>
            </li>

            <!-- SEZIONE: AUTOINSTALL -->
            <li class="collection-item">
                <h4 id="autoinstall">
                    AUTOINSTALL
                </h4>
                <p>Utilizzare AUTOINSTALL per installare e configurare automaticamente (quasi) tutto quello che serve. Il Raspberry si riavviera' automaticamente un paio di volte</p>
                <ul class="collection">
                    <li class="collection-item"> 
                        <p>Leggere la documentazione e scaricare AUTOINSTALL dal <a class="btn orange lighten-2" href="https://github.com/progetto201/progetto201-autoinstall">repository qui</a></p>
                        <blockquote>
                            La documentazione contiene alcuni dei possibili errori e le relative soluzioni e quindi e' consigliato leggerla
                            poiche' potrebbe essere necessario eseguire debugging/throubleshooting
                        </blockquote>

                        <blockquote>
                            La documentazione e' anche utile a capire se ha senso installare e configurare tutti i software...
                            Ad esempio commentare o cancellare le istruzioni che installano i seguenti software e eventualmente eseguirli successivamente manualmente: 
                            <ol class="collection">
                                <li class="collection-item">internalfunctions.sh installa Unclutter, che rende difficile lavorare su raspberry poiche' nasconde il cursore del mouse (utile in ambiente di produzione se si usa uno schermo touch)</li>
                                <li class="collection-item">internalfunctions.sh imposta il wallpaper del 100+100, se il comando da errore ignorarlo/decommentarlo poiche' il wallpaper non e' fondamentale</li>
                                <li class="collection-item">internalfunctions.sh importa il database del 100+100, e' possibile saltare l'import e eseguirlo dopo con il database del progetto201</li>
                                <li class="collection-item">automysql.sh modifica il metodo di accesso all'account root di MySQL: se eseguito prima della importazione l'importazione fallira'</li>
                                <li class="collection-item">internalfunctions.sh scarica dal repository del 100+100 e posiziona nella cartella "/var/www/html"  i file che Apache restituira' ai client web (browser)</li>
                                <li class="collection-item">
                                    Valutare se e' necessario "correre al debugging" per errori di PHPMyAdmin: ad esempio se qualcosa va storto durante la sua installazione e' consigliabile saltarla e 
                                    permettere allo script di installare e configurare servizi piu' importanti prima di cercare di risolvere il problema di PHPMyAdmin.
                                    PHPMyAdmin NON e' <a href="https://en.wikipedia.org/wiki/Mission_critical">mission critical</a>.
                                </li>
                            </ol>

                            <p>Se un comando da errore e' anche possibile commentare tutte le righe precedenti per evitare di ripetere l'intera esecuzione dello script</p>
                        </blockquote>
                        
                        <blockquote>
                            Ogni script richiamato da AUTOINSTALL ha la sua documentazione
                        </blockquote>
                    </li>
                    <li class="collection-item">
                        <p>
                            Aprire lo script "autoinstall.sh" e modificare a piacere i valori delle variabili sotto a "# -- VARIABLES"
                        </p> 
                        <blockquote>
                            SUGGERIMENTO: le variabili piu' importanti sono:
                            <ol class="collection">
                                <li class="collection-item">devmode: true installa PHPMyAdmin per avere una UI per gestire i database, false installa Unclutter, software che nasconde il mouse (adatto per schermi touch screen)</li>
                                <li class="collection-item">mysqlpass: password dell'utente root di MySQL. Verra' utilizzata da PHP per eseguire operazioni sul database del progetto, nome del database: "db100_100"</li>
                                <li class="collection-item">hostapd_ssid: SSID della rete Wi-Fi generata da Raspberry Pi (identifica la rete)</li>
                                <li class="collection-item">hostapd_password: password della rete Wi-Fi</li>
                            </ol>
                            <p>Le altre possono essere lasciate a valori di default 
                                <blockquote>
                                    <p>
                                        ESEMPIO: anche se vengono create piu' reti wireless con lo stesso range di indirizzi non c'e' pericolo di conflitti di IP... 
                                        Le reti non si vedono perche' Raspberry si comporta da NAT (IP Masquerade) e quindi l'unico indirizzo IP che puo' andare 
                                        in conflitto con altri indirizzi e' l'indirizzo dell'interfaccia ethernet "eth0" (rete cablata).
                                    </p>
                                    
                                    <p>
                                        MIGLIORAMENTO: disattivare, per motivi di sicurezza (riduciamo i diritti dei dispositivi al minimo), il masquerade per isolare i nodi nelle comunicazioni verso l'esterno (verso Internet e rete sulla eth0): <a href="https://www.raspberrypi.org/documentation/configuration/wireless/access-point-routed.md">link documentazione ufficiale</a> 
                                    </p>
                                </blockquote>
                            </p>
                        </blockquote>
                    </li>
                    <li class="collection-item">
                        Salvare e eseguire lo script da terminale con il comando 
                        <pre class="language-bash">
                            <code class="language-bash">
                                {% capture code %}
                                # posizionarsi prima con il terminale nella cartella dello script
                                ./autoinstall.sh
                                {% endcapture %}
                                {% include html/code.html html=code %}
                            </code>
                        </pre>
                    </li>
                </ul>
            </li>

            <!-- SEZIONE: TEST DI AUTOINSTALL -->
            <li class="collection-item">
                
                <h4 id="test-autoinstall">
                    Test di AUTOINSTALL
                </h4>
                <p>
                    A questo punto dovrebbero essere installati e configurati MySQL, Apache, PHP, dnsmasq, Hostapd.
                </p> 
                <p>
                    Verificare che tutto funzioni correttamente:
                    <ul class="collection">
                        <li class="collection-item">
                            Provare con un cellulare a collegarsi alla rete Wi-Fi creata da Raspberry:
                            se funziona significa che Hostapd ha creato la rete ed e' possibile collegarsi senza problemi
                        </li>
                        <li class="collection-item">
                            Provare poi ad aprire il browser su Raspberry e andare sulla pagina "localhost":
                            se viene visualizzata la pagina di benvenuto di Apache vuol dire che Apache riesce a rispondere alle richieste.
                            <blockquote>
                                Se e' stata restituita la pagina del progetto 100+100 vuol dire
                                che prima di eseguire lo script AUTOINSTALL non sono state commentate quelle istruzioni
                                di internalfunctions.sh che scaricavano i vecchi file.
                                Se la pagina viene restituita vuol dire comunque che Apache funziona.
                            </blockquote>
                        </li>
                        <li class="collection-item">
                            Provare a collegarsi da telefono con il browser alla pagina web restituita da Apache:
                            se funziona vuol dire che Apache e' accessibile sulla rete locale creata da Raspberry ma soprattutto
                            che dnsmasq (funzionante come server DHCP) ha fornito un IP automaticamente.
                            <blockquote>
                                Per accedere alla pagina web e' necessario sapere l'indirizzo IP del raspberry: in AUTOINSTALL
                                era presente la variabile "hostapd_ip", se non e' stata modificata l'IP e' "192.168.4.1",
                                altrimenti e' il valore della variabile. (Ignorando il CIDR, il numero che e' dopo la slash "/", slash compresa)
                                E' possibile anche utilizzare il comando: 
                                <pre class="language-bash">
                                    <code class="language-bash">
                                        {% capture code %}
                                        # se non dovesse funzionare provare "ip a"
                                        ifconfig
                                        {% endcapture %}
                                        {% include html/code.html html=code %}
                                    </code>
                                </pre>
                                E controllare l'IP della "wlan0", l'interfaccia wireless del raspberry.
                                Se si vuole provare a collegarsi da un computer sulla rete cablata inserire l'IP della interfaccia "eth0".
                            </blockquote>
                            <blockquote>
                                E' possibile accertare il suo funzionamento anche andando da smartphone nella pagina per collegarsi alle reti Wi-Fi
                                e cercare nei sotto menu' "Indirizzo IP". (provare a cliccare di nuovo sulla rete, provare a guardare nella sezione avanzate, ...)
                            </blockquote>
                        </li>
                        <li class="collection-item">
                            <p>
                                Provare a creare in "/var/www/html", la cartella di Apache, un file PHP e inserire qualcosa di semplice tipo:
                            </p> 

                            <pre class="language-php">
                                <code class="language-php">
                                    {% capture code %}
                                    &lt;?php
                                        echo "hei! Questo e' un test! se vedi solo questa stringa (senza 'php' e i tag) vuol dire che PHP e' installato correttamente";
                                    ?&gt;
                                    {% endcapture %}
                                    {% include html/code.html html=code %}
                                </code>
                            </pre>

                            <p>
                                E dopo provare a richiederlo da browser: se appare il messaggio senza "&lt;?php", "echo", ";" e "?&gt;" vuol dire che PHP funziona.
                            </p>

                            <blockquote>
                                Se era apparsa la pagina del progetto 100+100 ed e' apparsa la planimetria
                                vuol dire che PHP funziona (e anche MySQL).
                            </blockquote>
                        </li>
                        <li class="collection-item">
                            Per testare dnsmasq come server DNS provare a collegarsi alla pagina web inserendo nella barra degli
                            indirizzi "raspberry" e "raspberry.progetto201.com", dovrebbero funzionare entrambe.
                        </li>
                        <li class="collection-item">

                            Provare MySQL cercando di creare un database via PHPMyAdmin (se e' stato installato, e' possibile accedervi alla pagina "localhost/phpmyadmin" su raspberry) 
                            e poi importare il file SQL dalla sezione import:
                            
                            <br> <br>

                            <div class="center-align container">
                                <img class="materialboxed mx-auto resp-img" src="/assets/img/phpmyadmin/import.jpg" alt="Pagina importazione">
                            </div>
                            
                            <br><br>
                            <p>
                                Cliccare su "Importa", cliccare su "Scegli il file" e cercare sul computer il file .sql del progetto 201.
                                Infine cliccare su "Esegui".
                            </p>
                            
                            <br>
                            <hr>
                            <br>

                            oppure
                            importando il file .sql del progetto 201 (presente nel repository <a href="https://github.com/progetto201/progetto201-api">progetto201-api</a>) con il comando:
                            <pre class="language-bash">
                                <code class="language-bash">
                                    {% capture code %}
                                    # sostituisci &lt;path&gt; con il percorso del file sql
                                    sudo mysql &lt; "&lt;path&gt;"
                                    {% endcapture %}
                                    {% include html/code.html html=code %}
                                </code>
                            </pre>
                            E provare a eseguire una query:
                            <pre class="language-bash">
                                <code class="language-bash">
                                    {% capture code %}
                                    sudo mysql -e "SELECT * FROM db100_100.t_options"
                                    {% endcapture %}
                                    {% include html/code.html html=code %}
                                </code>
                            </pre>
                            Dovrebbe apparire una tabella simile a questa:
                            <pre class="language-bash">
                                <code class="language-bash">
                                    {% capture code %}
                                    +----+--------------+---------------+---------------+-----------+
                                    | id | color_scheme | min_timestamp | max_timestamp | map       |
                                    +----+--------------+---------------+---------------+-----------+
                                    |  1 | red darken-2 |             0 |             0 | realistic |
                                    +----+--------------+---------------+---------------+-----------+
                                    {% endcapture %}
                                    {% include html/code.html html=code %}
                                </code>
                            </pre>

                            <blockquote>
                                Se non si ha i permessi apparira' un errore simile a questo:
                                <pre class="language-bash">
                                    <code class="language-bash">
                                        {% capture code %}
                                        ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
                                        {% endcapture %}
                                        {% include html/code.html html=code %}
                                    </code>
                                </pre>
                                Se e' stato eseguito lo script AUTOINSTALL senza modifiche
                                probabilmente automysql.sh ha modificato la password.
                                Prima occorre accedere con la nuova password:
                                <pre class="language-bash">
                                    <code class="language-bash">
                                        {% capture code %}
                                        # sostutisci &lt;username&gt; con il nome utente
                                        # > nota: non c'e' spazio tra il nome utente e la "-u"
                                        sudo mysql -u&lt;username&gt; -p
                                        {% endcapture %}
                                        {% include html/code.html html=code %}
                                    </code>
                                </pre>
                                <p>
                                    Premere invio e verra' chiesta la password.
                                    E' possibile conoscere la password guardando la variabile "mysqlpass" in autoinstall.sh.
                                </p>
                                <p>
                                    Eseguire la query SQL per ottenere la tabella con i dati:
                                </p>
                                <pre class="language-sql">
                                    <code class="language-sql">
                                        {% capture code %}
                                        SELECT * FROM db100_100.t_options;
                                        {% endcapture %}
                                        {% include html/code.html html=code %}
                                    </code>
                                </pre>
                                Dovrebbe apparire la tabella indicata sopra.
                                Uscire dal client MySQL digitando "quit" e premendo invio.
                            </blockquote>
                        </li>
                    </ul>
                </p>
            </li>

            <!-- SEZIONE: MODIFICA PASSWORD MYSQL -->
            <li class="collection-item">
                <h4 id="modifica-password-mysql">
                    Modifica password MySQL
                </h4>
                <p>
                    Se fino ad ora non e' stata modificata occorre modificare la password di MySQL per permettere
                    a PHP di collegarsi al database.
                </p>
                <p>
                    Ci sono due opzioni:
                </p> 
                
                <blockquote>
                    Entrambe le opzioni fanno la stessa cosa, 
                    scegliere quella che in quel momento sembra la piu' veloce.
                    E' possibile fare un copia incolla? Eseguire la query SQL e' molto probabilmente la soluzione piu' veloce.
                </blockquote>

                <ul class="collection">
                    <li class="collection-item">
                        Eseguire automysql.sh di AUTOINSTALL in questo modo:
                        <pre class="language-bash">
                            <code class="language-bash">
                                {% capture code %}
                                # posizionarsi prima con il terminale nella cartella dello script e
                                # sostituire &lt;pass&gt; con la nuova password per l'utente root
                                ./automysql.sh -mysqlpass &lt;pass&gt;
                                {% endcapture %}
                                {% include html/code.html html=code %}
                            </code>
                        </pre>
                    </li>
                    <li class="collection-item">
                        Eseguire la query SQL senza automysql.sh:
                        <pre class="language-bash">
                            <code class="language-bash">
                                {% capture code %}
                                # sostituisci &lt;pass&gt; con la nuova password di MySQL dell'utente root
                                sudo mysql -e "GRANT ALL PRIVILEGES on *.* to 'root'@'localhost' IDENTIFIED BY '&lt;pass&gt;';FLUSH PRIVILEGES;"
                                {% endcapture %}
                                {% include html/code.html html=code %}
                            </code>
                        </pre>
                    </li>
                </ul>
            </li>

            <!-- SEZIONE: FRONTEND E API -->
            <li class="collection-item">
                <h4 id="frontend-api">
                    Frontend e API
                </h4>
                <p>
                    Installare la frontend e l'api del progetto201.
                </p>
                <ul class="collection">
                    <li class="collection-item">
                        <p>
                            Scaricare la backend API dal suo repository: <a href="https://github.com/progetto201/progetto201-api" class="btn orange lighten-2">Clicca qui</a>
                        </p>
                        <p>
                            Posizionare il contenuto della cartella "www" in "/var/www": dovrebbe ora contenere la cartella "credentials" e "html".
                            La cartella "credentials" contiene il file "credentials.ini" con le credenziali che verranno usate da PHP
                            per accedere a MySQL e al database. La cartella "html" contiene i file accessibili dai browser che si collegano ad Apache.
                        </p>
                        <p>
                            Modificare il file credentials.ini:
                            <pre class="language-ini">
                                <code class="language-ini">
                                    {% capture code %}
                                    DB_HOST=localhost
                                    DB_USER100=user
                                    DB_PASS100=pwd
                                    {% endcapture %}
                                    {% include html/code.html html=code %}
                                </code>
                            </pre>
                            Sostituire "user" con lo username (se non sono stati creati altri account usare "root")
                            e al posto di "pwd" digitare la password.
                            Puo' essere utile cambiare "DB_HOST" solo se il database si trova su un altro server.
                            <blockquote>
                                Per verificare l'installazione dell'API provare ad accedere alla pagina "http://localhost/api/colors/usercolor.php"
                                dal browser di raspberry.
                                Se appare un JSON senza errori, simile a questo l'API funziona:
                                <pre class="language-bash">
                                    <code class="language-bash">
                                        {% capture code %}
                                        {"errors":[],"data":{"id":"6","color_name":"red","color_hex":"#f44336"}}
                                        {% endcapture %}
                                        {% include html/code.html html=code %}
                                    </code>
                                </pre>
                            </blockquote>
                        </p>
                    </li>
                    <li class="collection-item">
                        <p>
                            Scaricare la frontend dal suo repository: <a href="https://github.com/progetto201/progetto201-frontend" class="btn orange lighten-2">Clicca qui</a>
                        </p>
                        <p>
                            Posizionare il contenuto della cartella "www" in "/var/www": adesso nella cartella "/var/www/html"
                            dovrebbe essere presente un file, "index.html" e due cartelle, "static" e "api" (cartella dell'API)
                            <blockquote>
                                <p>
                                    Per verificare l'installazione della frontend provare ad accedere alla pagina "localhost" dal browser di raspberry.
                                </p>
                                <p>
                                    Dovrebbe apparire una pagina simile a questa:
                                </p>
                                <div class="container center-align">
                                    <img class="materialboxed mx-auto resp-img" src="/assets/img/frontend/home.png" alt="Home del progetto201">
                                </div>
                                
                            </blockquote>
                        </p>
                    </li>
                </ul>
            </li>

            <!-- SEZIONE: MOSQUITTO -->
            <li class="collection-item">
                <h4 id="mosquitto">
                    Mosquitto
                </h4>
                <p>Installare mosquitto, broker MQTT per gestire i dati ricevuto via MQTT dai nodi e configurarlo per accettare solo nodi con username e password.
                    Digita i seguenti comandi oppure copia e incolla tutti i comandi (nota: in alto a destra dell'elemento con il codice e' presente il pulsante copia)
                </p>
                <pre class="language-bash">
                    <code class="language-bash">
                        {% capture code %}
                        # Aggiorniamo i repository di sistema
                        sudo apt-get update

                        # Installiamo mosquitto
                        sudo apt-get install mosquitto mosquitto-clients -y

                        # Assicuriamoci che parta all'avvio del OS
                        sudo systemctl enable mosquitto.service

                        # Creiamo un utente e una password (sostituisci &lt;user&gt; con il nome utente desiderato).
                        # Il terminale chiedera la password desiderata dopo aver premuto invio
                        sudo mosquitto_passwd -c /etc/mosquitto/passwd &lt;user&gt;

                        # Occorre configurare il file di configurazione di mosquitto:
                        # opzione 1:
                        #  digita:
                        # 
                        #         sudo nano /etc/mosquitto/conf.d/default.conf"
                        #
                        #  e poi scrivi nel file:
                        # 
                        #        allow_anonymous false
                        #        password_file /etc/mosquitto/passwd
                        #
                        # opzione 2: digita questo comando che automatizza i passaggi descritti qui sopra:
                        sudo printf "allow_anonymous false\npassword_file /etc/mosquitto/passwd" >> "/etc/mosquitto/conf.d/default.conf"

                        # E riavvia mosquitto
                        sudo systemctl restart mosquitto
                        {% endcapture %}
                        {% include html/code.html html=code %}
                    </code>
                </pre>
            </li>

            <!-- SEZIONE: MQTT_MANAGER -->
            <li class="collection-item">
                <h4 id="mqtt-manager">
                    MQTT_MANAGER
                </h4>
                <p>
                    Scaricare lo script MQTT_MANAGER, configurarlo e abilitare la sua esecuzione all'avvio.
                </p>
        
                <ul class="collection">
                   
                    <li class="collection-item">
                        Scaricare MQTT_MANAGER dal suo repository: <a href="https://github.com/progetto201/mqtt_manager" class="btn orange lighten-2">Clicca qui</a>
                    </li>
                    <li class="collection-item">
                        Installare le dipendenze del software (dopo essersi posizionati nella cartella di mqtt_manager) eseguendo questo comando:
                        <pre class="language-bash">
                            <code class="language-bash">
                                {% capture code %}
                                pip3 install -r requirements.txt
                                {% endcapture %}
                                {% include html/code.html html=code %}
                            </code>
                        </pre>
                    </li>
                    <li class="collection-item">
                        <p>
                            Creare un file ini di configurazione con la seguente struttura:
                        </p>
                        
                        <pre class="language-ini">
                            <code class="language-ini">
                                {% capture code %}
                                [Database]
                                username = &lt;username DB&gt;
                                password = &lt;password DB&gt;
                                host = &lt;dominio/IP DB&gt;
                                database = &lt;nome DB&gt;
                                
                                [MQTT broker]
                                username = &lt;username MQTT&gt;
                                password = &lt;password MQTT&gt;
                                host = &lt;dominio/IP MQTT&gt;
                                port = &lt;porta MQTT&gt;
                                {% endcapture %}
                                {% include html/code.html html=code %}
                            </code>
                        </pre>
                        <p>
                            Dove:
                        </p>
                        <ul class="collection">
                            <li class="collection-item">username, sezione "[Database]": nome utente per connettersi a MySQL ("root")</li>
                            <li class="collection-item">password, sezione "[Database]": password per connettersi a MySQL (la password configurata precedentemente)</li>
                            <li class="collection-item">host, sezione "[Database]": indirizzo IP o nome dominio del server MySQL ("localhost")</li>
                            <li class="collection-item">database, sezione "[Database]": nome del database ("db100_100")</li>
                            <li class="collection-item">username, sezione "[MQTT broker]": nome utente per connettersi al broker MQTT (in questo caso a mosquitto, scegliere il nome utente configurato precedentemente)</li>
                            <li class="collection-item">password, sezione "[MQTT broker]": password per connettersi al broker MQTT</li>
                            <li class="collection-item">host, sezione "[MQTT broker]": indirizzo IP o nome dominio del server con il broker MQTT ("localhost")</li>
                            <li class="collection-item">port, sezione "[MQTT broker]": porta in ascolto del broker MQTT ("1883", la porta di default di MQTT)</li>
                        </ul>
                        <blockquote>
                            <p>
                                Tra parentesi sono specificati i valori da utilizzare se si sta seguendo
                                questa guida senza alcuna modifica.
                            </p>
                            <p>
                                Se si desidera ad esempio spostare il database su un'altro server
                                e' possibile modificare la relativa variabile.
                            </p> 
                        </blockquote>
                    </li>
                    <li class="collection-item">
                        Specificare allo script di Python il percorso della configurazione modificando la variabile chiamata "configfile_path".
                        <blockquote>
                            Meglio specificare il percorso completo, lo script verra' chiamato all'avvio e occorre avere la certezza che il file
                            possa essere trovato indipendentemente dal percorso di esecuzione dello script.
                        </blockquote>
                    </li>
                    <li class="collection-item">
                        Impostare l'esecuzione automatica dello script all'avvio del Raspberry Pi:
                        <pre class="language-bash">
                            <code class="language-bash">
                                {% capture code %}
                                # sostituire &lt;path&gt; con il percorso assoluto/completo dello script mqtt_manager.py
                                sudo bash -c "echo @python3 &lt;path&gt;" | sudo cat - /etc/xdg/lxsession/LXDE-pi/autostart > temp && sudo mv temp /etc/xdg/lxsession/LXDE-pi/autostart
                                {% endcapture %}
                                {% include html/code.html html=code %}
                            </code>
                        </pre>
                        <blockquote>
                            Il comando qui sopra inserisce nel file al percorso "/etc/xdg/lxsession/LXDE-pi/autostart" l'istruzione "@python3 &lt;path&gt;"
                        </blockquote>
                    </li>
                    <li class="collection-item">
                        A questo punto quando il broker MQTT, mosquitto, riceve messaggi via MQTT lo script Python riceve il messaggio,
                        intuisce dal topic ("path" della conversazione, simile alle sottocartelle all'interno degli URL) se si tratta di un nodo
                        (e se e' appena stato aggiunto o no al sistema) o se si tratta di dati rilevati dai sensori.
                        Python in base al tipo di dato decide cosa fare con il database.
                        (aggiungere dati e nodi, aggiornare informazioni sul nodo, ...)
                    </li>
                </ul>
            </li>

            <!-- SEZIONE: SKETCH ARDUINO -->
            <li class="collection-item">
                <h4 id="sketch-arduino">
                    Sketch Arduino
                </h4>
                <p>
                    Scaricare, configurare e caricare lo sketch arduino su un nodo per iniziare a rilevare dati.
                </p>
                <p>
                    In questo caso verranno indicati i passi necessari per caricare
                    lo sketch DATACLIENT-DHT22, che si occupa di rilevare temperatura e umidita'
                    utilizzando il sensore DHT22, su un NodeMCU ma si daranno informazioni generali
                    per possibili sketch futuri o per microcontrollori diversi dal ESP8266 (montato sul NodeMCU).
                </p>
                
                <ul class="collection">
                    <li class="collection-item">
                        Se non e' gia' installato, installare l'arduino IDE dal sito ufficiale: <a href="https://www.arduino.cc/en/Main/Software" class="btn orange lighten-2">Clicca qui</a>
                    </li>
                    <li class="collection-item">
                        <p>
                            Installare i driver dal sito del produttore della scheda su cui caricare lo sketch.
                        </p>
                        <p>
                            Per il NodeMCU scaricare i driver da qui: <a href="https://www.silabs.com/products/mcu/Pages/USBtoUARTBridgeVCPDrivers.aspx" class="btn orange lighten-2">Clicca qui</a>
                        </p>
                    </li>
                    <li class="collection-item">
                        Indicare all'arduino IDE l'URL del repository che permette di gestire la scheda:
                        <ul class="collection">
                            <li class="collection-item">
                                <p>
                                    Aprire le impostazioni andando su "File -> Impostazioni":
                                </p>
                                <div class="center-align container">
                                    <img class="materialboxed mx-auto resp-img" src="/assets/img/arduino/opensettings.png" alt="Apri impostazioni da file">
                                </div>
                            </li>
                            <li class="collection-item">
                                <p>
                                    Aggiungi questa riga in "Url aggiuntive per il gestore di schede":
                                </p>
                                <pre class="language-bash">
                                    <code class="language-bash">
                                        {% capture code %}
                                        http://arduino.esp8266.com/stable/package_esp8266com_index.json
                                        {% endcapture %}
                                        {% include html/code.html html=code %}
                                    </code>
                                </pre>
                                <div class="center-align container">
                                    <img class="materialboxed mx-auto resp-img" src="/assets/img/arduino/settings.jpg" alt="Impostazioni">
                                </div>
                            </li>
                            <li class="collection-item">
                                Chiudere la finestra, l'Arduino IDE e infine riaprire l'Arduino IDE.
                                <blockquote>
                                    Questo permette all'Arduino IDE di scaricare le informazioni dall'URL
                                </blockquote>
                            </li>
                            <li class="collection-item">
                                <p>Vai in "Strumenti -> Scheda -> Gestore Schede" e cerca il pacchetto della scheda, per il NodeMCU cercare "esp8266 by ESP8266 Community"</p>
                                <div class="center-align container">
                                    <img class="materialboxed mx-auto resp-img" src="/assets/img/arduino/openboardmanager.png" alt="Apri gestore di schede">
                                </div>
                                <p>Installa il pacchetto cliccando su "installa"</p>
                                <div class="center-align container">
                                    <img class="materialboxed mx-auto resp-img" src="/assets/img/arduino/boardmanager.png" alt="Gestore di schede">
                                </div>
                            </li>
                            <li class="collection-item">
                                Installare le librerie necessarie per lo sketch. Per cercare le librerie andare in "Sketch --> #Include libreria --> Gestione librerie":
                                <div class="center-align container">
                                    <img class="materialboxed mx-auto resp-img" src="/assets/img/arduino/openlibrary.png" alt="Apri gestione librerie">
                                </div>

                                <p>Per il DATACLIENT-DHT22 sono necessarie le seguenti librerie:</p>
                                <ol class="collection">
                                    <li class="collection-item">
                                        "ArduinoJson by Benoit Blanchon" per gestire oggetti JSON
                                    </li>
                                    <li class="collection-item">
                                        "Adafruit Unified Sensor by Adafruit", libreria necessaria per le altre librerie di sensori di Adafruit
                                    </li>
                                    <li class="collection-item">
                                        "DHT sensor library by Adafruit" per gestire il DHT22
                                    </li>
                                    <li class="collection-item">
                                        "PubSubClient by Nick O'Leary" per connettersi e inviare messaggi al broker MQTT
                                    </li>
                                </ol>
                            </li>
                            <li class="collection-item">
                                <p>
                                    Modifica le variabili dello sketch. Per il DATACLIENT-DHT22 cambiare queste variabili:
                                </p>
                                <ul class="collection">
                                    <li class="collection-item">
                                        <p>
                                            "DHTPIN": pin dati del DHT22
                                        </p> 
                                        <blockquote>
                                            <p>
                                                NOTA: il numero pin nello sketch e il numero sulla scheda non corrispondono
                                            </p>
                                            <div class="center-align container">
                                                <img class="materialboxed mx-auto resp-img" src="/assets/img/arduino/nodemcu-pinout.jpg" alt="Pinout NodeMCU">
                                            </div>
                                        </blockquote>
                                    </li>
                                    <li class="collection-item">
                                        "mqttServer": stringa contenente IP/dominio del broker MQTT
                                    </li>
                                    <li class="collection-item">
                                        "mqttPort": porta in ascolto del broker MQTT
                                    </li>
                                    <li class="collection-item">
                                        "mqttUser": utente broker MQTT
                                    </li>
                                    <li class="collection-item">
                                        "mqttPassword": password di mqttUser
                                    </li>
                                    <li class="collection-item">
                                        "timeToWait": tempo tra le letture
                                    </li>
                                    <li class="collection-item">
                                        "WIFI_SSID": SSID access point Wi-Fi
                                    </li>
                                    <li class="collection-item">
                                        "WIFI_PASS": password access point Wi-Fi
                                    </li>
                                </ul>
                            </li>
                            <li class="collection-item">
                                Cambia la scheda corrente con la scheda su cui caricare lo sketch (per il NodeMCU: "Generic ESP8266 Module") dal menu strumenti.
                            </li>
                            <li class="collection-item">
                                <p>
                                    In strumenti, seleziona le impostazioni consigliate dal produttore della scheda per poter caricare lo sketch.
                                </p>
                                <p>
                                    Per il NodeMCU selezionare queste impostazioni:
                                </p> 
                                <pre class="language-ini">
                                    <code class="language-ini">
                                        {% capture code %}
                                        Flash Mode = QIO
                                        Flash Frequency = 40MHz
                                        CPU Frequency = 80MHz
                                        Flash Size = 4M 1M SPIFFS
                                        Reset Method = nodemcu
                                        Upload Speed = 115200
                                        {% endcapture %}
                                        {% include html/code.html html=code %}
                                    </code>
                                </pre>
                            </li>
                            <li class="collection-item">
                                Selezionare da Strumenti la porta a cui e' connessa la scheda e premere il pulsante Carica per caricare lo sketch.
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>

            <!-- SEZIONE: LOCATION DEI NODI -->
            <li class="collection-item">
                <h4 id="location-nodi">
                    Location dei nodi
                </h4>
                <p>
                    Aggiungere location sul database e modificare la location del nodo.
                </p>
                <blockquote>
                    Attualmente non e' possibile fare queste operazioni da UI ma sarebbe fattibile.
                </blockquote>
                <ul class="collection">
                    <li class="collection-item">
                        <p>
                            Aggiungere location nella tabella "t_locations".
                        </p>
                        <p>
                            Con PHPMyAdmin e' possibile utilizzare la GUI per creare un nuovo record con il nome della location. 
                        </p>
                        <p>Da linea di comando occorre eseguire una istruzione SQL:</p>
                        
                        <pre class="language-bash">
                            <code class="language-bash">
                                {% capture code %}
                                sudo mysql -u&lt;username&gt; -p -e "INSERT INTO db100_100.t_locations (description) VALUES ('&lt;nome_location&gt;');"
                                {% endcapture %}
                                {% include html/code.html html=code %}
                            </code>
                        </pre>
                        
                        <blockquote>
                            <p>
                                Sostituire &lt;username&gt; con lo username per connettersi a MySQL (se non impostato diversamente in precedenza e' "root").
                            </p>
                            <p>
                                Sostituire '&lt;nome_location&gt;' con il nome della location (es. 'cucina', 'soggiorno', ...).
                            </p>
                            <p>
                                Dopo aver premuto invio sara' richiesta la password di &lt;username&gt; per accedere a MySQL.
                            </p>
                        </blockquote>
                        
                        <p>
                            Verificare che la nuova location sia stata inserita eseguendo il comando:
                        </p>
                        <pre class="language-bash">
                            <code class="language-bash">
                                {% capture code %}
                                sudo mysql -u&lt;username&gt; -p -e "SELECT * FROM db100_100.t_locations;"
                                {% endcapture %}
                                {% include html/code.html html=code %}
                            </code>
                        </pre>
                        <blockquote>
                            Come prima specificare lo username, premere invio e inserire la password per MySQL.
                        </blockquote>

                        <p>
                            Dovrebbe apparire una tabella con la location "sconosciuta" e la nuova location.
                        </p>
                        <p>
                            Ripetere l'istruzione INSERT per ogni location che si vuole aggiungere al sistema.
                        </p>
                        
                    </li>
                    <li class="collection-item">
                        <p>
                            Modificare la location dei nodi.
                        </p>
                        <p>
                            Dopo aver caricato lo sketch sul nodo MQTT_MANAGER dovrebbe aver ricevuto via MQTT le informazioni del nodo
                            e queste informazioni sono state memorizzate sul database nella tabella "t_nodi".
                            Tutti i nodi di default hanno la location impostata a "sconosciuta". (o meglio, id 0 delle location).
                        </p>
                        <p>
                            Da PHPMyAdmin e' possibile modificare il valore del campo "location_id" per farlo corrispondere
                            all'id della location del nodo.
                        </p>
                        <p>
                            Da linea di comando:
                        </p>
                        <pre class="language-bash">
                            <code class="language-bash">
                                {% capture code %}
                                sudo mysql -u&lt;username&gt; -p -e "UPDATE db100_100.t_nodi SET location_id = &lt;id_location&gt; WHERE id = &lt;id_nodo&gt;;"
                                {% endcapture %}
                                {% include html/code.html html=code %}
                            </code>
                        </pre>
                        <blockquote>
                            <p>
                                Sostituire &lt;username&gt; con lo username per connettersi a MySQL (se non impostato diversamente in precedenza e' "root").
                            </p>
                            <p>
                                Sostituire &lt;id_location&gt; con l'id della location da impostare (id della location nella tabella t_locations)
                            </p>
                            <p>
                                Sostituire &lt;id_nodo&gt; con l'id del nodo (id nella tabella t_nodi).
                                Per identificare il nodo e' possibile utilizzare l'indirizzo MAC o l'indirizzo IP del nodo per riconoscere il nodo
                                oppure caricare lo sketch arduino su un nodo alla volta.
                            </p>
                        </blockquote>
                    </li>
                </ul>
            </li>

            <!-- SEZIONE: PLANIMETRIA PERSONALIZZATA E LABEL -->
            <li class="collection-item">
                <h4 id="planimetria-label">
                    Planimetria personalizzata e label
                </h4>
                <p>
                    Aggiungere planimetrie e label alla planimetria.
                </p>
                
                <ul class="collection">
                    <li class="collection-item">
                        Per la guida su come personalizzare/aggiungere planimetrie
                        <a class="btn orange lighten-2" href="/floorplan.html">Clicca qui</a>
                        o clicca su "Personalizzare planimetria" nella sidenav a sinistra. 
                        (su smartphone occorre premere il pulsante hamburger <i class="material-icons">menu</i> a sinistra del titolo della pagina
                        o eseguire uno swipe dal bordo a sinistra della pagina verso destra)
                    </li>
                    <li class="collection-item">
                        <p>
                            Per aggiungere i label sulla planimetria per renderla interattiva occorre andare sulla pagina impostazioni
                            del progetto201.
                        </p>
                        <p>
                            Andare nella sezione "Dati planimetria":
                        </p>
                        <div class="center-align container">
                            <img class="materialboxed mx-auto resp-img" src="/assets/img/frontend/settings_labels.png" alt="Label planimetria">
                        </div>
                        <p>
                            e cliccare su "AGGIUNGI" per aggiungere del testo, oppure "AGGIUNGI AREA" per creare una area cliccabile, oppure "AGGIUNGI LETTURA SENSORE" per visualizzare l'ultima rilevazione di un dato di uno specifico nodo.
                        </p>
                        <p>
                            Tenere premuto l'elemento con il pulsante sinistro e muovere il mouse per trascinarlo.
                            Posizionare l'elemento nella posizione desiderata.
                        </p>
                        <p>
                            Sotto alla planimetria premere il pulsante "MODIFICA" per visualizzare altre impostazioni, "RIMUOVI" per cancellare il label e "SALVA" per salvare le modifiche.
                        </p>
                        <div>
                            Se si preme sul pulsante "AGGIUNGI AREA", si clicca sull'area e poi si clicca su "MODIFICA" appariranno 4 impostazioni:
                            <ul class="collection">
                                <li class="collection-item">
                                    "Modifica id": permette di scegliere un identificativo facile da ricordare per l'elemento
                                </li>
                                <li class="collection-item">
                                    "Modifica lunghezza": modifica la lunghezza dell'area. Per le aree si consiglia di aumentare la loro lunghezza
                                    per coprire una certa stanza o una certa area di una stanza.
                                </li>
                                <li class="collection-item">
                                    "Modifica altezza": modifica l'altezza dell'area. Per le aree si consiglia di aumentare la loro altezza
                                    per coprire una certa stanza o una certa area di una stanza.
                                </li>
                                <li class="collection-item">
                                    "Modifica identificativo nodo": permette di selezionare per quale nodo verranno visualizzati i grafici quando
                                    si preme sopra all'area dalla pagina principale.
                                    <blockquote>
                                        Il selettore visualizza id e indirizzo MAC del nodo, sarebbe piu' user friendly visualizzare anche il nome della location.
                                    </blockquote>
                                </li>
                            </ul>
                            <p>
                                Premere il pulsante "SALVA" per salvare le modifiche e aggiungere i nuovi label alla planimetria della pagina principale.
                            </p>
                        </div>
                        
                        <br><hr><br>

                        <div>
                            Se si preme sul pulsante "AGGIUNGI LETTURA SENSORE", si clicca sull'elemento e poi si clicca su "MODIFICA" appariranno le seguenti impostazioni:
                            <ul class="collection">
                                <li class="collection-item">
                                    "Modifica testo": permette di scegliere un testo da visualizzare prima che il sistema abbia ottenuto dal database l'ultima rilevazione.
                                    Difficilmente sara' visibile.
                                </li>
                                <li class="collection-item">
                                    "Modifica id": permette di scegliere un identificativo facile da ricordare per l'elemento
                                </li>
                                <li class="collection-item">
                                    "Modifica lunghezza": modifica la lunghezza dell'elemento. Per le rilevazioni si consiglia di rendere l'elemento
                                    grande quanto basta per farci stare il valore da visualizzare.
                                </li>
                                <li class="collection-item">
                                    "Modifica altezza": modifica l'altezza dell'elemento. Per le rilevazioni si consiglia di rendere l'elemento
                                    grande quanto basta per farci stare il valore da visualizzare.
                                </li>
                                <li class="collection-item">
                                    "Modifica identificativo nodo": permette di selezionare per quale nodo verranno visualizzate le rilevazioni.
                                </li>
                                <li class="collection-item">
                                    "Modifica dato desiderato dal nodo": permette di selezionare quale dato visualizzare del nodo.
                                    Questi nomi sono i nomi dei campi delle tabelle dati dei nodi.
                                    <blockquote>
                                        I nodi delle tabelle dati seguono questo standard: "t_type&lt;id_tipo_nodo&gt;_data" dove 
                                        &lt;id_tipo_nodo&gt; e' l'identificativo del tipo di nodo (ad esempio il tipo 0 contiene i dati dai microcontrollori con lo sketch DATACLIENT-DHT22,
                                        quindi sono microcontrollori che rilevano temperatura e umidita' grazie ad un unico sensore, il DHT22)
                                    </blockquote>
                                </li>
                            </ul>
                            <p>
                                Premere il pulsante "SALVA" per salvare le modifiche e aggiungere i nuovi label alla planimetria della pagina principale.
                            </p>
                        </div>

                        <br><hr><br>

                        <div>
                            Se si preme sul pulsante "AGGIUNGI TESTO", si clicca sull'elemento e poi si clicca su "MODIFICA" appariranno le seguenti impostazioni:
                            <ul class="collection">
                                <li class="collection-item">
                                    "Modifica testo": permette di scegliere un testo da visualizzare. Potrebbe essere utile ad esempio per visualizzare "%" vicino alle umidita'.
                                    <blockquote>
                                        Se si riesce a far accettare gli unicode al sistema sarebbe possibile visualizzare "&#8451;" vicino alle temperature.
                                    </blockquote>
                                </li>
                                <li class="collection-item">
                                    "Modifica id": permette di scegliere un identificativo facile da ricordare per l'elemento
                                </li>
                                <li class="collection-item">
                                    "Modifica lunghezza": modifica la lunghezza dell'elemento. Per i testi si consiglia di rendere l'elemento
                                    grande quanto basta per farci stare il testo da visualizzare.
                                </li>
                                <li class="collection-item">
                                    "Modifica altezza": modifica l'altezza dell'elemento. Per i testi si consiglia di rendere l'elemento
                                    grande quanto basta per farci stare il testo da visualizzare.
                                </li>
                                <li class="collection-item">
                                    "Modifica identificativo nodo": Non e' utilizzato, si potrebbe nascondere/rimuovere per i testi.
                                </li>
                            </ul>
                            <p>
                                Premere il pulsante "SALVA" per salvare le modifiche e aggiungere i nuovi label alla planimetria della pagina principale.
                            </p>
                        </div>

                        <br><hr><br>

                        <p>
                            Ora tornando alla pagina principale dovrebbe essere presente la planimetria con sopra i label.
                            <blockquote>
                                Provare a cliccare sulle aree per verificare che si apra la pagina dei grafici corretta e provare a vedere se le letture dei sensori
                                si aggiornano con il passare del tempo.
                            </blockquote>
                        </p>
                    </li>
                </ul>
            </li>
        </ol>
</div>